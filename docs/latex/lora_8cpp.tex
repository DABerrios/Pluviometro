\doxysection{src/lora.cpp File Reference}
\hypertarget{lora_8cpp}{}\label{lora_8cpp}\index{src/lora.cpp@{src/lora.cpp}}
{\ttfamily \#include $<$lora.\+h$>$}\newline
{\ttfamily \#include $<$main.\+h$>$}\newline
{\ttfamily \#include $<$SD\+\_\+adp.\+h$>$}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{lora_8cpp_ad00e5aa32f425c7cf5b551edbe4e2018}{os\+\_\+get\+Art\+Eui}} (u1\+\_\+t \texorpdfstring{$\ast$}{*}buf)
\item 
void \mbox{\hyperlink{lora_8cpp_a59f8459c9afe001b9d082b88f24bbc06}{os\+\_\+get\+Dev\+Eui}} (u1\+\_\+t \texorpdfstring{$\ast$}{*}buf)
\item 
void \mbox{\hyperlink{lora_8cpp_a876d512ca10c7f577c86f5dc1894bc49}{os\+\_\+get\+Dev\+Key}} (u1\+\_\+t \texorpdfstring{$\ast$}{*}buf)
\item 
void \mbox{\hyperlink{lora_8cpp_a70f58dcb5b0adb04adcb7cb1115d4f99}{lora\+WAN\+\_\+config\+\_\+and\+\_\+transmition}} ()
\begin{DoxyCompactList}\small\item\em Configures and initiates the Lo\+Ra\+WAN transmission. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{lora_8cpp_ab42efec0e8860ab768280a3d778b4c0e}{do\+\_\+send}} (osjob\+\_\+t \texorpdfstring{$\ast$}{*}j)
\begin{DoxyCompactList}\small\item\em Sends data using the Lo\+Ra\+WAN protocol. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{lora_8cpp_aaead836f5e0f65f5906b7ce269e92436}{on\+Event}} (ev\+\_\+t ev)
\begin{DoxyCompactList}\small\item\em Event handler for Lo\+Ra events. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{lora_8cpp_a518c053fc83e3afad95a7eb888108e66}{send\+Data\+From\+File}} (const char \texorpdfstring{$\ast$}{*}filename)
\begin{DoxyCompactList}\small\item\em Sends data from a specified file over Lo\+Ra. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{lora_8cpp_a86bc61487b3cb470dab5c850ac501b2d}{Lineprocessing}} (const String \&line, uint8\+\_\+t \texorpdfstring{$\ast$}{*}data, float avrg\+\_\+temp)
\begin{DoxyCompactList}\small\item\em Processes a line of data and converts it into a binary format. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{lora_8cpp_a8b87e6c24b58790f84babe4f50e2cf48}{save\+Last\+Position}} (unsigned long position)
\begin{DoxyCompactList}\small\item\em Saves the last position to persistent storage. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{lora_8cpp_ad7595540527b820ae0c64023481d60c8}{read\+Last\+Position}} ()
\begin{DoxyCompactList}\small\item\em Reads the last saved position from preferences. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{lora_8cpp_aa77586c54009a37ee5ea1b088db21fe1}{data\+\_\+processing}} (const char \texorpdfstring{$\ast$}{*}filename, uint8\+\_\+t \texorpdfstring{$\ast$}{*}data)
\begin{DoxyCompactList}\small\item\em Processes data from a file and calculates the average temperature. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const unsigned \mbox{\hyperlink{lora_8cpp_a48aaa6046ac1d9b5b7172f7be7a6f7e1}{TX\+\_\+\+INTERVAL}} = 30
\item 
const lmic\+\_\+pinmap \mbox{\hyperlink{lora_8cpp_a82b2c57ed09941537a4e8bf84b35a5eb}{lmic\+\_\+pins}}
\item 
bool \mbox{\hyperlink{lora_8cpp_ae896ade8de020eddf38adba829f22445}{lora\+WANActive}} = false
\item 
int RTC\+\_\+\+DATA\+\_\+\+ATTR \mbox{\hyperlink{lora_8cpp_a4deb953346a0b30864d5a84815bd99c2}{last\+\_\+line}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{lora_8cpp_aa77586c54009a37ee5ea1b088db21fe1}\index{lora.cpp@{lora.cpp}!data\_processing@{data\_processing}}
\index{data\_processing@{data\_processing}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{data\_processing()}{data\_processing()}}
{\footnotesize\ttfamily \label{lora_8cpp_aa77586c54009a37ee5ea1b088db21fe1} 
size\+\_\+t data\+\_\+processing (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{filename}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{data}{}\end{DoxyParamCaption})}



Processes data from a file and calculates the average temperature. 

This function reads data from the specified file starting from the last read position, calculates the average temperature from the data, and processes the last line of data.


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read data from. \\
\hline
{\em data} & A pointer to a buffer where processed data will be stored. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The size of the processed data. 
\end{DoxyReturn}
\Hypertarget{lora_8cpp_ab42efec0e8860ab768280a3d778b4c0e}\index{lora.cpp@{lora.cpp}!do\_send@{do\_send}}
\index{do\_send@{do\_send}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{do\_send()}{do\_send()}}
{\footnotesize\ttfamily \label{lora_8cpp_ab42efec0e8860ab768280a3d778b4c0e} 
void do\+\_\+send (\begin{DoxyParamCaption}\item[{osjob\+\_\+t \texorpdfstring{$\ast$}{*}}]{j}{}\end{DoxyParamCaption})}



Sends data using the Lo\+Ra\+WAN protocol. 

This function checks if there is a current TX/\+RX job running. If there is no ongoing transmission or reception, it prepares an upstream data transmission at the next possible time.


\begin{DoxyParams}{Parameters}
{\em j} & Pointer to the osjob\+\_\+t structure representing the job to be executed.\\
\hline
\end{DoxyParams}
The function performs the following actions\+:
\begin{DoxyItemize}
\item If a TX/\+RX job is currently running, it logs a message indicating that the transmission is pending and does not send data.
\item If no TX/\+RX job is running, it queues a packet for transmission and logs a message indicating that the packet has been queued.
\end{DoxyItemize}

The next transmission is scheduled after the TX\+\_\+\+COMPLETE event. \Hypertarget{lora_8cpp_a86bc61487b3cb470dab5c850ac501b2d}\index{lora.cpp@{lora.cpp}!Lineprocessing@{Lineprocessing}}
\index{Lineprocessing@{Lineprocessing}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{Lineprocessing()}{Lineprocessing()}}
{\footnotesize\ttfamily \label{lora_8cpp_a86bc61487b3cb470dab5c850ac501b2d} 
size\+\_\+t Lineprocessing (\begin{DoxyParamCaption}\item[{const String \&}]{line}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{float}]{avrg\+\_\+temp}{}\end{DoxyParamCaption})}



Processes a line of data and converts it into a binary format. 

This function takes a line of data in the form of a string, parses it to extract temperature, rainfall, date, time, and ID information, and then converts these values into a binary format stored in the provided data array.


\begin{DoxyParams}{Parameters}
{\em line} & The input string containing the data to be processed. \\
\hline
{\em data} & A pointer to the array where the binary data will be stored. \\
\hline
{\em avrg\+\_\+temp} & The average temperature to be used in the processing. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes written to the data array. 
\end{DoxyReturn}
\Hypertarget{lora_8cpp_a70f58dcb5b0adb04adcb7cb1115d4f99}\index{lora.cpp@{lora.cpp}!loraWAN\_config\_and\_transmition@{loraWAN\_config\_and\_transmition}}
\index{loraWAN\_config\_and\_transmition@{loraWAN\_config\_and\_transmition}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{loraWAN\_config\_and\_transmition()}{loraWAN\_config\_and\_transmition()}}
{\footnotesize\ttfamily \label{lora_8cpp_a70f58dcb5b0adb04adcb7cb1115d4f99} 
void lora\+WAN\+\_\+config\+\_\+and\+\_\+transmition (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Configures and initiates the Lo\+Ra\+WAN transmission. 

This function initializes the Lo\+Ra\+WAN stack, sets up the session keys, configures the channels, and sends data from a specified file.

\begin{DoxyNote}{Note}
The debug print statements are included for development purposes and should be removed in the final version.
\end{DoxyNote}
The function performs the following steps\+:
\begin{DoxyItemize}
\item Initializes the Lo\+Ra\+WAN stack.
\item Resets the LMIC (Lo\+Ra\+MAC-\/in-\/C) library.
\item Sets up the session keys for communication.
\item Configures the channels based on the region (e.\+g., CFG\+\_\+au915).
\item Disables link check mode.
\item Sets the data rate and transmission power.
\item Sends data from the specified file.
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em None} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None 
\end{DoxyReturn}
\Hypertarget{lora_8cpp_aaead836f5e0f65f5906b7ce269e92436}\index{lora.cpp@{lora.cpp}!onEvent@{onEvent}}
\index{onEvent@{onEvent}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{onEvent()}{onEvent()}}
{\footnotesize\ttfamily \label{lora_8cpp_aaead836f5e0f65f5906b7ce269e92436} 
void on\+Event (\begin{DoxyParamCaption}\item[{ev\+\_\+t}]{ev}{}\end{DoxyParamCaption})}



Event handler for Lo\+Ra events. 

This function is called whenever a Lo\+Ra event occurs. It prints the event time and type to the serial monitor and handles specific events accordingly.


\begin{DoxyParams}{Parameters}
{\em ev} & The event type (ev\+\_\+t) that occurred.\\
\hline
\end{DoxyParams}
Event types handled\+:
\begin{DoxyItemize}
\item EV\+\_\+\+TXSTART\+: Transmission started.
\item EV\+\_\+\+SCAN\+\_\+\+TIMEOUT\+: Scan timed out.
\item EV\+\_\+\+BEACON\+\_\+\+FOUND\+: Beacon found.
\item EV\+\_\+\+BEACON\+\_\+\+MISSED\+: Beacon missed.
\item EV\+\_\+\+BEACON\+\_\+\+TRACKED\+: Beacon tracked.
\item EV\+\_\+\+JOINING\+: Joining network.
\item EV\+\_\+\+JOINED\+: Joined network.
\item EV\+\_\+\+RFU1\+: Reserved for future use.
\item EV\+\_\+\+JOIN\+\_\+\+FAILED\+: Joining network failed.
\item EV\+\_\+\+REJOIN\+\_\+\+FAILED\+: Rejoining network failed.
\item EV\+\_\+\+TXCOMPLETE\+: Transmission complete (includes waiting for RX windows).
\item EV\+\_\+\+LOST\+\_\+\+TSYNC\+: Lost time synchronization.
\item EV\+\_\+\+RESET\+: Reset event.
\item EV\+\_\+\+RXCOMPLETE\+: Data received in ping slot.
\item EV\+\_\+\+LINK\+\_\+\+DEAD\+: Link dead.
\item EV\+\_\+\+LINK\+\_\+\+ALIVE\+: Link alive.
\item Default\+: Unknown event. 
\end{DoxyItemize}\Hypertarget{lora_8cpp_ad00e5aa32f425c7cf5b551edbe4e2018}\index{lora.cpp@{lora.cpp}!os\_getArtEui@{os\_getArtEui}}
\index{os\_getArtEui@{os\_getArtEui}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{os\_getArtEui()}{os\_getArtEui()}}
{\footnotesize\ttfamily \label{lora_8cpp_ad00e5aa32f425c7cf5b551edbe4e2018} 
void os\+\_\+get\+Art\+Eui (\begin{DoxyParamCaption}\item[{u1\+\_\+t \texorpdfstring{$\ast$}{*}}]{buf}{}\end{DoxyParamCaption})}

\Hypertarget{lora_8cpp_a59f8459c9afe001b9d082b88f24bbc06}\index{lora.cpp@{lora.cpp}!os\_getDevEui@{os\_getDevEui}}
\index{os\_getDevEui@{os\_getDevEui}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{os\_getDevEui()}{os\_getDevEui()}}
{\footnotesize\ttfamily \label{lora_8cpp_a59f8459c9afe001b9d082b88f24bbc06} 
void os\+\_\+get\+Dev\+Eui (\begin{DoxyParamCaption}\item[{u1\+\_\+t \texorpdfstring{$\ast$}{*}}]{buf}{}\end{DoxyParamCaption})}

\Hypertarget{lora_8cpp_a876d512ca10c7f577c86f5dc1894bc49}\index{lora.cpp@{lora.cpp}!os\_getDevKey@{os\_getDevKey}}
\index{os\_getDevKey@{os\_getDevKey}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{os\_getDevKey()}{os\_getDevKey()}}
{\footnotesize\ttfamily \label{lora_8cpp_a876d512ca10c7f577c86f5dc1894bc49} 
void os\+\_\+get\+Dev\+Key (\begin{DoxyParamCaption}\item[{u1\+\_\+t \texorpdfstring{$\ast$}{*}}]{buf}{}\end{DoxyParamCaption})}

\Hypertarget{lora_8cpp_ad7595540527b820ae0c64023481d60c8}\index{lora.cpp@{lora.cpp}!readLastPosition@{readLastPosition}}
\index{readLastPosition@{readLastPosition}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{readLastPosition()}{readLastPosition()}}
{\footnotesize\ttfamily \label{lora_8cpp_ad7595540527b820ae0c64023481d60c8} 
void read\+Last\+Position (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Reads the last saved position from preferences. 

This function initializes the preferences with the namespace "{}last\+\_\+line"{} and retrieves the integer value associated with the key "{}last\+\_\+line"{}. If the key does not exist, it defaults to 0. \Hypertarget{lora_8cpp_a8b87e6c24b58790f84babe4f50e2cf48}\index{lora.cpp@{lora.cpp}!saveLastPosition@{saveLastPosition}}
\index{saveLastPosition@{saveLastPosition}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{saveLastPosition()}{saveLastPosition()}}
{\footnotesize\ttfamily \label{lora_8cpp_a8b87e6c24b58790f84babe4f50e2cf48} 
void save\+Last\+Position (\begin{DoxyParamCaption}\item[{unsigned long}]{position}{}\end{DoxyParamCaption})}



Saves the last position to persistent storage. 

This function stores the given position value in a persistent storage using the preferences API. The position is saved under the key "{}last\+\_\+line"{}.


\begin{DoxyParams}{Parameters}
{\em position} & The position value to be saved. \\
\hline
\end{DoxyParams}
\Hypertarget{lora_8cpp_a518c053fc83e3afad95a7eb888108e66}\index{lora.cpp@{lora.cpp}!sendDataFromFile@{sendDataFromFile}}
\index{sendDataFromFile@{sendDataFromFile}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{sendDataFromFile()}{sendDataFromFile()}}
{\footnotesize\ttfamily \label{lora_8cpp_a518c053fc83e3afad95a7eb888108e66} 
void send\+Data\+From\+File (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{filename}{}\end{DoxyParamCaption})}



Sends data from a specified file over Lo\+Ra. 

This function initializes the SD card, opens the specified file, and reads data from it. If the file has been read before, it seeks to the last read position. If the next character in the file is a newline, the function puts the device to sleep. Otherwise, it processes the data and sends it using Lo\+Ra. The function waits until the transmission is complete before returning.


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read data from. \\
\hline
\end{DoxyParams}


\doxysubsection{Variable Documentation}
\Hypertarget{lora_8cpp_a4deb953346a0b30864d5a84815bd99c2}\index{lora.cpp@{lora.cpp}!last\_line@{last\_line}}
\index{last\_line@{last\_line}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{last\_line}{last\_line}}
{\footnotesize\ttfamily \label{lora_8cpp_a4deb953346a0b30864d5a84815bd99c2} 
int RTC\+\_\+\+DATA\+\_\+\+ATTR last\+\_\+line = 0}

\Hypertarget{lora_8cpp_a82b2c57ed09941537a4e8bf84b35a5eb}\index{lora.cpp@{lora.cpp}!lmic\_pins@{lmic\_pins}}
\index{lmic\_pins@{lmic\_pins}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{lmic\_pins}{lmic\_pins}}
{\footnotesize\ttfamily \label{lora_8cpp_a82b2c57ed09941537a4e8bf84b35a5eb} 
const lmic\+\_\+pinmap lmic\+\_\+pins}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \{}
\DoxyCodeLine{\ \ \ \ .nss\ =\ \mbox{\hyperlink{lora_8h_a90e2250233b92babc91add8daf5e27b2}{SX1276\_NSS}},}
\DoxyCodeLine{\ \ \ \ .rxtx\ =\ LMIC\_UNUSED\_PIN,}
\DoxyCodeLine{\ \ \ \ .rst\ =\ \mbox{\hyperlink{lora_8h_ae3fdfec46955b03f05c8d7715dc41d79}{SX1276\_RST}},}
\DoxyCodeLine{\ \ \ \ .dio\ =\ \{\mbox{\hyperlink{lora_8h_a839015d97f9441df848f67d41570cf90}{SX1276\_DIO0}},\ \mbox{\hyperlink{lora_8h_a1787bdfd224acaec2e10ddaf2b153b7a}{SX1276\_DIO1}},\ LMIC\_UNUSED\_PIN\},}
\DoxyCodeLine{\}}

\end{DoxyCode}
\Hypertarget{lora_8cpp_ae896ade8de020eddf38adba829f22445}\index{lora.cpp@{lora.cpp}!loraWANActive@{loraWANActive}}
\index{loraWANActive@{loraWANActive}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{loraWANActive}{loraWANActive}}
{\footnotesize\ttfamily \label{lora_8cpp_ae896ade8de020eddf38adba829f22445} 
bool lora\+WANActive = false}

\Hypertarget{lora_8cpp_a48aaa6046ac1d9b5b7172f7be7a6f7e1}\index{lora.cpp@{lora.cpp}!TX\_INTERVAL@{TX\_INTERVAL}}
\index{TX\_INTERVAL@{TX\_INTERVAL}!lora.cpp@{lora.cpp}}
\doxysubsubsection{\texorpdfstring{TX\_INTERVAL}{TX\_INTERVAL}}
{\footnotesize\ttfamily \label{lora_8cpp_a48aaa6046ac1d9b5b7172f7be7a6f7e1} 
const unsigned TX\+\_\+\+INTERVAL = 30}

